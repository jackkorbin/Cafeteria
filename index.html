<!DOCTYPE html>

<html class="no-js">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Cafeteria</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/custom.css">


    
        <style>
          body{
/*            background-color:#22313F;*/
              background:#8ec1da url(img/food2.jpg) no-repeat center center fixed;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
            font-weight:normal;
            
          }
      </style>
    
</head>
<body>

    <div class="custom">
        
        
        
        <div class="main-box">
            <div class="overlay">
                <span class="btn btn-success btn-history">
                    <span class="glyphicon glyphicon-chevron-left"></span>
                    History
                </span>
                <div class="title">
<!--
                    <i class="glyphicon glyphicon-cutlery"></i>
                    <span> Easy Cafe </span>
-->
                    <span>Cafetaria</span>
                </div>
                
                
            </div>
            

<!--
            <ul class="nav nav-tabs nav-justified tab-ul" >
              <li class="active"><a class="" href="#menu" data-toggle="tab">Menu</a></li>
              <li class=""><a class="" href="#randomfood" data-toggle="tab">Random</a></li>
            </ul>
-->


<!--
            <ul class="nav navbar-nav custom-tab-ul hidden-xs" id="myTab">
                <li class="custom-list active"><a href="#menu" data-toggle="tab" class=""><i class="glyphicon glyphicon-heart"></i><span>Cafe Menu</span></a></li>
                <li class="custom-list"><a href="#randomfood" data-toggle="tab" class=""><i class="glyphicon glyphicon-fire"></i><span>Selected Food</span></a></li>
            </ul>
-->
            
<!--
            <ul class="nav navbar-nav custom-tab-ul" id="myTab">
                <li class="custom-list active"><a href="#menu" data-toggle="tab" class=""><i class="glyphicon glyphicon-heart"></i><span>Menu</span></a></li>
                <li class="custom-list"><a href="#randomfood" data-toggle="tab" class=""><i class="glyphicon glyphicon-fire"></i><span>Selected</span></a></li>
            </ul>
-->


            
             <div class="tab-content settings">
                
                <div class="fade in tab-pane active" id="menu"><!-- Tab 1 -->
                    
                    <div class="main-content menu">
                        <div class="inputs-menu">
                            <input type="text" class="form-control" id="name-menu" placeholder="Name">
                            <input type="text" class="form-control" id="budget-menu" placeholder="Budget">
                        </div>
                        
                        <div class="selected-box-cont">
                            <div class="selected-box">
                                
                                <div id="what">
<!--
                                    <div class="fooditem no-margin">
                                        <span class="name" id="name">
                                            Rajma chawal
                                        </span>
                                        <span class="">
                                             x 4 
                                        </span>
                                        <span class="cost" id="cost">
                                            78 Rs
                                        </span>
                                    </div>
-->
                                    No Items Selected!
                                </div>
                                
                                
                                <div class="btn btn-danger bottom-tab-button-back back">
                                    <span class="glyphicon glyphicon-chevron-left"></span>
                                    Back
                                </div>
                                <div class="btn btn-success bottom-tab-button-back save" id="savehistory">
                                    <span class="glyphicon glyphicon-check"></span>
                                    Save
                                </div>
                                
                            
                            </div> 
                        </div>
                        
                        <div id="show-menu">                 
<!--
                            <div class="fooditem">
                                <span class="name" id="name">
                                    Rajma chawal
                                </span>
                                <select class="quan form-control" id="quan"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option></select>
                                <span class="cost" id="cost">
                                    78
                                </span>
                            </div>
--> 
                            <i class="glyphicon glyphicon-refresh spin"></i>
                        </div>
                        
<!--                        HISTORY TAB-->
                        
                        <div class="history-box-cont">
                            <div class="history-box">
                                
                                <div class="overlay overlay-his">
                                    <span> History </span>
                                </div>
                                
                                <div id="history">
                                    
<!--
                                    <div class="onedate">
                                        
                                        <div class="fooditem fooditem-date">
                                            <span class="name" id="name">
                                                2nd june 2014
                                            </span>
                                            <span class="cost" id="cost">
                                                282 Rs
                                            </span>
                                            <span class="glyphicon glyphicon-chevron-down"></span>
                                        </div>
                                        
                                        <div class="fooditem-subs-cont">
                                            <div class="fooditem-subs">
                                                <span class="name">
                                                    Rajma Chawal x 1
                                                </span>
                                                <span class="cost">
                                                    76 Rs
                                                </span>
                                            </div>
                                            <div class="fooditem-subs">
                                                <span class="subs-name">
                                                    Cheese pizza x 4
                                                </span>
                                                <span class="cost">
                                                    206 Rs
                                                </span>
                                            </div>
                                        </div>
                                        
                                    </div>
-->
                                    <div class="onedate">
                                        No History!! <br>
                                        Make sure You Saved your order.
                                    </div>
                                    
                                    
                                    
                                    <div class="fooditem total-css">
                                        <span class="name" id="name">
                                            Total
                                        </span>
                                        <span class="cost" id="cost">
                                            780 Rs
                                        </span>
                                    </div>
                                    

                                </div>
                                
                                
                                
                                <div class="btn btn-danger bottom-tab-button-back save" id="clearhistory">
                                    <span class="glyphicon glyphicon-trash"></span>
                                    Clear History
                                </div>
                                <div class="btn btn-warning bottom-tab-button-back back" id="hidehistorytab">
                                    <span class="glyphicon glyphicon-home"></span>
                                    Back
                                </div>
                                
                                
                            
                            </div> 
                        </div>
                        
                        
                        
                    </div>
                </div> <!-- End of tab 1 -->
            

<!--
                <div class="fade in tab-pane" id="randomfood">
                    <div class="main-content">
                        
                        <input type="text" class="form-control" id="budget" placeholder="Enter Budget">
                        
                        <div id="show">
                        </div>
                        
                    </div>
                
                    <button class="btn generatebtn" id="random">Generate Food</button>
                   
                </div> 
-->

                 
                
                 
                
            
        
        </div>

        
<!--
        <div class="footer">
            Created by <span>Jack korbin</span>
        </div>
-->
            
        <div id="totalcost" class="total-cost">
            <div class="clear bottom-tab-button">
<!--                <span class="glyphicon glyphicon-fire"></span>-->
                Clear all
            </div>
            <div class="total bottom-tab-button">
                Total 0 Rs.
                
            </div>
            <div class="confirm bottom-tab-button">
                Confirm
<!--                <span class="glyphicon glyphicon-forward"></span>-->
            </div>
        </div>
            
        
    </div>
        
        
        
    </div>

        
    
      
    
    
<script src="js/vendor/jquery-1.11.0.min.js"></script>
<script src="js/vendor/bootstrap.min.js"></script>
<script src="menu.json"></script>
<script>
    
var showmenuheight = parseInt($(document).innerHeight() - 180);

    
$(document).ready(function(){
    
    $('#myTab a').click(function () {
      $(this).tab('show');
    });
    
    fetchmenu();
    
    $('#name-menu, #budget-menu').keyup(sortmenu);
    
    
    
});
    
$(window).load(function(){
    
    clearall();
    
});
    
//HISTORY TAB -->
    
function showhistorytab(){
    $('.history-box-cont').show(200);
    updatehistory();
}
function hidehistorytab(){
    $('.history-box-cont').hide(200);
}


$(document).on('click','#hidehistorytab',function(){
    hidehistorytab();
});
$(document).on('click','.btn-history',function(){
    showhistorytab();
});
    
    
/// EDIT AND FETCH HISTORY -->
    
var arrayofselecteditems = new Array();
    
var history = getLocalStorage() || dispError('Local Storage not supported.');
    
function update_arrayofselecteditems(name,quantity,cost){
    var fooddetail = {
        'name':name,
        'quantity':quantity,
        'cost':cost
    };
    arrayofselecteditems.push(fooddetail);
}
    
function getLocalStorage() {
    try {
        if( !! window.localStorage ) return window.localStorage;
    } 
    catch(e) {
        return undefined;
    }
}
    
function updatehistory(){

    var wholedates = '';
    var w1 = '';
    var w2 = '';
    var cost = 0;;
    var total = 0;
    if( history.length == 0 ){
        wholedates = '<div class="onedate">No History. <br>Are you sure You Saved your order?</div>';
    }
    else{
        for(var i in history){
//            console.log(i);
            var temp = JSON.parse( history.getItem( i ) );
            var date = i.split(" ");
            var time = coverttotime(date[4]);
            
            w1 += '<div class="onedate">';
            w1 += '<div class="fooditem fooditem-date">';
            w1 += '<span class="name" id="name">'+time+' '+date[2]+' '+date[1]+' '+date[3]+'</span><span class="cost" id="cost">';
            w2 += ' Rs</span><span class="glyphicon glyphicon-chevron-down icon"></span></div>'; // FOODITEM-date DIV closed
            w2 += '<div class="fooditem-subs-cont">';
                for( var j=0; j<temp.length; j++ ){
                    w2 += '<div class="fooditem-subs"><span class="name">'+temp[j].name+' x '+temp[j].quantity+'</span><span class="cost">'+temp[j].cost+' Rs</span></div>';
                    cost += temp[j].cost;
                }
            w2 += '</div>';
            w2 += '</div>';

            
            total += cost;
            wholedates += w1+cost+w2;
            w1 = '';
            w2 = '';
            cost = 0;
        }
    }
    
    wholedates += '<div class="fooditem total-css"><span class="name" id="name">Total</span><span class="cost" id="cost">'+total+' Rs</span></div>';
    
    
    $('#history').html(wholedates);
}
updatehistory();
    

$(document).on("click", ".onedate", function() {
    $(this).find('.fooditem-subs-cont').slideToggle(200);
    $(this).find('.fooditem-date .icon').slideToggle(200);
    
});
    
function coverttotime(t){
    var mode = "am";
    t = t.split(':');
    if( t[0] > 12 ){
        t[0] = t[0] - 12;
        mode = "pm";
    }
    var time = t[0]+':'+t[1]+' '+mode;
    return time;
}
    
function savehistory(){
    
    var currentTime = new Date();
    
    history.setItem(currentTime, JSON.stringify(arrayofselecteditems) );
    
}
    
function clearhistory(){
    
    history.clear();
    arrayofselecteditems = [];
}


$(document).on("click", "#clearhistory", function() {
    clearhistory();
    updatehistory();
});
    
$(document).on("click", "#savehistory", function() {
    savehistory();
    hidehistorytab();
    clearall();
});
    

    
    
    
    
/// UPDATE TOTAL : -->
    
$(document).on("change", ".quan", function() {
    foods = $('#show-menu div .name');
    quantity = $('#show-menu div .quan');
    costs = $('#show-menu div .cost');
    
    var total = 0;
    var texts = '';
    
    for (var i=0; i < foods.length; i++) {
        if (parseInt(quantity[i].value) > 0) {
            costi = parseInt(costs[i].innerHTML);
            
            texts += '<div class="fooditem no-margin"><span class="name" id="name">'+foods[i].innerHTML+'</span><span class=""> x '+parseInt(quantity[i].value)+' </span><span class="cost" id="cost"> '+ (costi * parseInt(quantity[i].value)) +' Rs</span></div>';
            
            total += (costi * parseInt(quantity[i].value)); 
            
            var repeat = false;
            
            for(var j=0; j<arrayofselecteditems.length; j++){
                
                if( foods[i].innerHTML == arrayofselecteditems[j].name  ){
                    repeat = true;
                    if( parseInt(quantity[i].value) == arrayofselecteditems[j].quantity ){
                        break;
                    }
                    else{
                        arrayofselecteditems[j].quantity = parseInt(quantity[i].value);
                        break;
                    }
                }
                
            }
            
            if( repeat == false  ){
                    update_arrayofselecteditems(foods[i].innerHTML,parseInt(quantity[i].value),costi * parseInt(quantity[i].value));

            }
    
        }
        else {
            for(var j=0; j<arrayofselecteditems.length; j++){
                
                if( foods[i].innerHTML == arrayofselecteditems[j].name  ){
                    arrayofselecteditems.splice(j,1);
                    break;
                }
                
            }
        }
        
        if( parseInt(quantity[i].value) == 0 ){
            $('#fooditem'+i+' .quan').css({'border-bottom':'2px solid #81CFE0'});
        }
        else{
            $('#fooditem'+i+' .quan').css({'border-bottom':'2px solid #D91E18'});
        }
        
        
        
    }
    
    //texts += "TOTAL : Rs. " + total;
    
    $('.total.bottom-tab-button').html(total+" Rs." );
    
    if( texts == '' ){
        $('#what').html('No Items Selected!');
    }
    else{
        $('#what').html(texts);
    }
});
    
// CLEAR ALL -->    
$(document).on("click", ".bottom-tab-button.clear", function() {
    clearall();
    hideselected();
});
    

  
    
//$(document).on("click", ".fooditem", function() {
//    $(this).find('.quan').trigger('change');
//});
    
    
// SELECTED BOX SLIDES -->    
var togglebool = 1;    
$(document).on("click", ".confirm", function() {
    
    if( togglebool == 1 ){
        showselected();
        
    }
    else{
        hideselected();
        togglebool = 1;
    }
});
$(document).on("click", ".bottom-tab-button-back.back", function() {
   
    
    hideselected();
    
});
    
$(window).resize(function() { 
    responsiveness(); 
});
    
    
function responsiveness(){
    showmenuheight = parseInt($(document).innerHeight() - 180);
    $('#show-menu').css('height',showmenuheight+'px');
    $('.selected-box').css('height',showmenuheight + 56+'px');
    $('.history-box').css('height',showmenuheight + 59 +56+'px');
    $('#history').css('height',showmenuheight + -30 +'px');
    $('#history').scrollTop($('#history')[0].scrollHeight);
}
    
function showselected(){
    $('.selected-box-cont').css('display','block');
    $('.selected-box').animate({'left':'0px'},300);


    //$('.confirm').html('<i class="glyphicon glyphicon-refresh spin"></i>');
    setTimeout(function(){
        $('.confirm').html('Back');
    },100);
    togglebool = 0;
}
function hideselected(){
    $('.selected-box').animate({'left':'500px'},300);
    setTimeout(function(){
        $('.selected-box-cont').css('display','none');
    },300);

    $('.confirm').html('Confirm');
    togglebool = 1;
}
function clearall(){
    fetchmenu();
    $('#what').html('');
    $('.total.bottom-tab-button').html('Total 0 Rs.');
    arrayofselecteditems = [];
}
    
    
//FETCH AND SORT MENU -->

function sortmenu(){
    
    var name = ($('#name-menu').val()).toLowerCase();
    var budget = $('#budget-menu').val();
    
    
    //$('.fooditem').css('display','none');
    
    for( var i=0; i<menu.length;i++ ){
        $('#fooditem'+i).css({'display':'none'});
        
        if( (menu[i].cost <= budget || budget == '') && ( (menu[i].name.toLowerCase()).indexOf(name) != -1 || name == '' ) ){
            //text += '<div class="fooditem"><span class="name">'+menu[i].name+'</span><span class="cost">'+menu[i].cost+' Rs</span></div>';
            $('#fooditem'+i).css({'display':'block'});
            
        }
    }
    
}
    
    
function fetchmenu(){
    
    var text = '';
    for( i=0; i < menu.length; i++ ){
        
        text += '<div class="fooditem" id="fooditem'+i+'"><span class="name" id="name">' + menu[i].name + '</span>' +  options() + '<span class="cost" id="cost">'+ menu[i].cost +' Rs. </span></div>';
    }
    
    
    var j = $('.main-content').width();
    //$('.selected-box').css('left','calc( 50% - '+ j/2 +'px )');
    
    
    $('#show-menu').html(text);
    
    responsiveness();
    
    
    $('#show-menu').show(500);
    
    
}

function options() {
    return '<select class="quan" id="quan"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option></select>';
}
    
    
    
    
////RANDOM GENERATOR FUNCTIONS --> 
//    
//$('#random').click(function(){
//    
//    $('.generatebtn').html('<i class="glyphicon glyphicon-refresh spin"></i>');
//
//    setTimeout(function(){
//        valuechecker();
//    },500);
//    
//    
//});
//    
//    
//function valuechecker(){
//    if( isNaN($('#budget').val()) ){
//        $('#show').html('<div class="error">Enter a Valid input or Get Lost.</div>');
//        $('.generatebtn').html('Generate Random');
//    }
//    else if( $('#budget').val() < 4 ){
//        $('#show').html('<div class="error">You should probably go to mess.</div>');
//        $('.generatebtn').html('Generate Random');
//    }
//    else if( $('#budget').val() < 50 ){
//        selectrandomfood(1);
//    }
//    else if( $('#budget').val() < 120 ){
//        selectrandomfood(2);
//    }
//    else if( $('#budget').val() < 200 ){
//        selectrandomfood(3);
//    }
//    else{
//        selectrandomfood(4);
//    }
//}
//    
//    
//    
//function selectrandomfood(n){
//    $('#show').html('');
//    var budget = $('#budget').val();
//    
//    var total = 0;
//    var text = '';
//    var happnd = [];
//    
//    for( var i = 0 ; i < n; i++){
//        
//        var j = Math.floor(Math.random() * menu.length);
//        
//        if( happnd.indexOf(j) != -1 || menu[j].category == 'Cakes/Pastry' || menu[j].category == 'Ice Cream' ){
//            i--;
//            continue;
//        }
//        happnd.push(j);
//        text = text+'<div class="fooditem"><span class="name">'+menu[j].name+'</span><span class="cost">'+menu[j].cost+' Rs</span></div>';
//       
//        total += menu[j].cost;
//    }
//    if( total > budget  ){
//
//        $('#show').html('');
//        selectrandomfood(n);
//        return 0;
//    }
//    else{
//        
//        if( budget < 250 && total < budget/2 && budget > 50 ){
//            console.log('here');
//            $('#show').html('');
//            selectrandomfood(n);
//            return 0;
//        }
//        else{
//            $('#show').hide(200);
//            $('#show').append(text);
//            $('#show').append('<div class="fooditem"><span class="name">Total</span><span class="cost">'+total+' Rs</span></div>');
//            $('#show').show(200);
//            $('.generatebtn').html('Generate Again');
//        }
//    }
//}

    

    
    
    
    
</script>
        
</body>
</html>
